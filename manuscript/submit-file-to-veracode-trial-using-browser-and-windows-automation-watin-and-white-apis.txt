## Submit file to Veracode Trial: using Browser and Windows Automation (WatiN and White APIs)

This script automates the process off submitting a file to Veracode's free trial (as of 20/Jul/2011). See also [Consuming Veracode Findings File(s) using O2](http://o2platform.wordpress.com/2011/07/01/consuming-veracode-findings-files-using-o2/). If first provides a settings GUI, where the user can enter the requried data (email and file to upload), then fires up a web brower and uses WatiN (Browser Automation) plus White (Windows UIAutomation) to populate the form fields and to submit the form. The reason why I had to use UIAutomation (and White API) was because there didn't seem to be a way to modify the HTML form field of the 'file upload' control (even jQuery didn't seem to be able to modify that value programatially). The solution was to use UIAutomation to: 

  * click on the 'Browse' field,
  * then (on the popup file dialog window)

    * enter the file to upload, and
    * click 'Close'

Here is the 'settings window: ![](images/tmp77c0-tmp.jpeg) When the button is clicked the veracode trial page is opened and the 'Html Form File Upload Button' is pressed (via UIAutomation) : ![](images/tmpf7fa-tmp.jpeg) When the 'Choose File to Upload' window appears, the 'File Name Text Box' is populated and the Open Button is pressed (both using UIAutomation (via White API)). Finally, the email field is populated, the check box is ticked and the 'Upload' button is pressed (using Browser Automation (WatiN)) [![](images/tmp93ef-tmp.jpeg)](http://o2platform.files.wordpress.com/2011/07/tmp93ef-tmp.jpeg) Here is the source code of this script: [sourcecode language="csharp" wraplines="false"] var topPanel = O2Gui.open<Panel>("Util - Submit file to Veracode Trial",700,180); //var topPanel = panel.clear().add_Panel(); topPanel.insert_LogViewer(); var _email = "o2@o2platform.com"; var _fileToUpload = @"C:\O2\Demos\jPetStore - O2 Demo Pack\apache-tomcat-7.0.16\webapps\jpetstore.war"; Action<string,string> submitFileToVeracode = (email, fileToUpload)=> { var windowName= "Veracode File Upload - {0}".format(10.randomLetters()); var ie = windowName.popupWindow(1000,500) .add_IE().open("https://trial.veracode.com/freetrials/veracode-free-trial-signup.php"); var processId = Processes.getCurrentProcessID(); var apiGuiAutomation = new API_GuiAutomation(processId); var window = apiGuiAutomation.window(windowName); "got main window".info(); var buttons = window.buttons();a "found {0} buttons".info(buttons.size()); buttons[1].mouse().click(); "clicked button".debug(); var selectFileWindow = apiGuiAutomation.window("Choose File to Upload"); selectFileWindow.textBoxes()[0].set_Text(fileToUpload); selectFileWindow.button("Open").click(); ie.field("email",email); ie.checkBoxes()[0].check(); ie.button("Upload").click(); //buttons[2].mouse().click(); }; topPanel.add_TextBox("Email",_email).top(0) .width(100) .onTextChange((text)=>_email=text) .append_Label("File to upload") .autoSize() .top(3) .append_TextBox(_fileToUpload) .onTextChange((text)=>_fileToUpload=text) .width(300) .align_Right(topPanel); topPanel.add_Button(24,"Create Account and Upload File") .font_bold() .align_Right(topPanel) .onClick(()=> submitFileToVeracode(_email, _fileToUpload) ); //O2File:WatiN_IE_ExtensionMethods.cs //using O2.XRules.Database.Utils.O2 //O2Ref:WatiN.Core.1x.dll //O2File:API_GuiAutomation.cs //O2Ref:White.Core.dll [/sourcecode]
