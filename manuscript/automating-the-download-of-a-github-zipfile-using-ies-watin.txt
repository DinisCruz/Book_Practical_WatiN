## Automating the Download of a GitHub ZipFile (using IE's WatiN)

Here is a script that uses WatiN's FileDownloadHandler to automate the download of a web page in IEÂ (which popups to save it) [sourcecode language="csharp" wraplines="false"] var ie = "ie_hLZRz".o2Cache<WatiN_IE>(()=> panel.clear().add_IE()).silent(true); //using WatiN.Core.DialogHandlers Func<string,string, string> open_and_HandleFileDownload = (url, fileName)=>{ var tmpFile = fileName.tempFile(); var waitUntilHandled = 20; var waitUntilDownload = 300; var fileDownloadHandler = ie.dialogHandler<FileDownloadHandler>(); if (fileDownloadHandler.notNull()) { ie.IE.RemoveDialogHandler(fileDownloadHandler); } fileDownloadHandler = new FileDownloadHandler(tmpFile); ie.IE.AddDialogHandler(fileDownloadHandler); fileDownloadHandler.field("saveAsFilename",tmpFile); fileDownloadHandler.field("hasHandledFileDownloadDialog",false); ie.open_ASync(url); try { fileDownloadHandler.WaitUntilFileDownloadDialogIsHandled(waitUntilHandled); "after: {0}".info("WaitUntilFileDownloadDialogIsHandled"); fileDownloadHandler.WaitUntilDownloadCompleted(waitUntilDownload); "after: {0}".info("WaitUntilDownloadCompleted"); } catch(Exception ex) { "[WatiN_IE][open_and_HandleFileDownload] {0}".error(ex.Message); } if (fileDownloadHandler.SaveAsFilename.fileExists()) { "[WatiN_IE] downloaded ok '{0}' into '{1}'".info(url, fileDownloadHandler.SaveAsFilename); return fileDownloadHandler.SaveAsFilename; } "[WatiN_IE] failed to download '{0}' ".info(url); return null; }; return open_and_HandleFileDownload("https://github.com/SecurityInnovation/YASAT/zipball/master_", "download.zip"); //O2File:WatiN_IE_ExtensionMethods.cs //O2Ref:WatiN.Core.1x.dll //_O2Tag_DontAddExtraO2Files; //O2File:_Extra_methods_Collections.cs [/sourcecode] The example above did a download from a puplic repository, if you need to access a private one (which required GitHub login), here is how to do it: [sourcecode language="csharp" wraplines="false"] if(ie.url() != "https://github.com/DinisCruz/TeamMentor-v3.0") ie.open("https://github.com/DinisCruz/TeamMentor-v3.0"); var githubAccount = @"C:\O2\_USERDATA\accounts.xml".credential("github"); Action loginToGitHub = ()=>{ if(ie.hasLink("Login")) { ie.link("Login").click(); ie.field("login_field").value(githubAccount.UserName); ie.field("password").value(githubAccount.Password); ie.button("Log in").click(); } }; loginToGitHub(); return open_and_HandleFileDownload("https://github.com/DinisCruz/TeamMentor-v3.0/zipball/master", "download.zip"); [/sourcecode]
